app-id: app.bluebubbles.BlueBubbles
runtime: org.gnome.Platform
runtime-version: '43'
sdk: org.gnome.Sdk
command: bluebubbles
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --system-talk-name=org.freedesktop.NetworkManager
  - --system-talk-name=org.freedesktop.NetworkManager.Connection.Active
  - --system-talk-name=org.freedesktop.FileManager1
  - --share=network
  - --filesystem=home
modules:
  - 'shared-modules/libappindicator/libappindicator-gtk3-12.10.json'
  - 'shared-modules/dbus-glib/dbus-glib.json'
  - name: zenity
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/zenity.git
        tag: 3.43.0
        commit: 01e6d92f23f49414ba8ec4c5b3daf49222c1e31d
    cleanup:
      - /share/*
      - /bin/gdialog
  - name: objectbox
    buildsystem: simple
    build-commands:
      - 'cp -r libobjectbox.so /app/lib/'
    sources:
      - type: archive
        only-arches:
          - x86_64
        url: https://github.com/objectbox/objectbox-c/releases/download/v0.16.0/objectbox-linux-x64.tar.gz
        sha256: b597c10607bbba71b238c935581ee7bde5ea07211d899bd4581685e495da01f8
      - type: archive
        only-arches:
          - aarch64
        url: https://github.com/objectbox/objectbox-c/releases/download/v0.16.0/objectbox-linux-aarch64.tar.gz
        sha256: 6f9cbff3892d28c7192e60f20ef23762c385817fc25a2844f354075b507e6f8b
  - name: libidn
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libidn/libidn-1.41.tar.gz
        sha256: 884d706364b81abdd17bee9686d8ff2ae7431c5a14651047c68adf8b31fd8945
    cleanup:
      - /bin/*
      - /include/*
      - /share/*
  - name: vlc
    config-opts:
      - 'BUILDCC=/usr/bin/gcc -std=gnu99'
      - --disable-a52
      - --disable-lua
      - --disable-dav1d
    make-args:
      - libcompat
    sources:
      - type: archive
        url: http://download.videolan.org/pub/videolan/vlc/3.0.17.3/vlc-3.0.17.3.tar.xz
        sha256: 6f7e90ef8973d31d96de64db817173e345150829717a94084b1bb8321cde2014
    cleanup:
      - /bin/*
      - /include/*
      - /share/*
      - /lib/vlc
      - '*.la'
      - '*/.a'
  - name: bluebubbles
    buildsystem: simple
    build-commands:
      - 'cp -r bluebubbles /app/'
      - 'chmod +x /app/bluebubbles/bluebubbles'
      # Manually set the app version
      - 'touch /temp.json && jq ''.version = "1.10.1.1"'' /app/bluebubbles/data/flutter_assets/version.json > /temp.json && mv /temp.json /app/bluebubbles/data/flutter_assets/version.json'
      - 'mkdir -p /app/bin'
      - 'ln -s /app/bluebubbles/bluebubbles /app/bin/bluebubbles'
      - 'install -Dm644 app.bluebubbles.BlueBubbles.metainfo.xml -t /app/share/metainfo/'
      - 'install -Dm644 128x128.png /app/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png'
      - 'install -Dm644 app.bluebubbles.BlueBubbles.desktop -t /app/share/applications/'
    sources:
      - type: archive
        only_arches:
          - x86_64
        dest: bluebubbles
        url: https://github.com/BlueBubblesApp/bluebubbles-app/releases/download/v1.10.1%2B36/bluebubbles-linux-x86_64.tar
        sha256: 51a24a9ee7d40f8bd97e760018f782982aec38c8197daa162cdf8ffa8c693899
      - type: archive
        only_arches:
          - aarch64
        dest: bluebubbles
        url: https://github.com/BlueBubblesApp/bluebubbles-app/releases/download/v1.10.1%2B36/bluebubbles-linux-aarch64.tar
        sha256: e065db26981c5d10bb7e508df30f624723b97493be6746af92c3d5f9c3de4114
      - type: file
        path: app.bluebubbles.BlueBubbles.metainfo.xml
      - type: file
        path: icons/128x128.png
      - type: file
        path: app.bluebubbles.BlueBubbles.desktop
    cleanup:
      - /bluebubbles/data/flutter_assets/packages/record_windows
      - /bluebubbles/data/flutter_assets/packages/wakelock_web
      - /bluebubbles/data/flutter_assets/packages/flutter_dropzone_web
      - /bluebubbles/data/flutter_assets/packages/libphonenumber_plugin
      - /temp.json
